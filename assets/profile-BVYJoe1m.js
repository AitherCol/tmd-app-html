import{a2 as G,aB as R,j as r,a6 as F,aC as O,r as q,A as B,u as V,l as H,x as P,S as c,H as A,aD as T,Y as $,ai as L,v,G as N,o as x,p as f,q as C,s as j,O as Z,aE as Y,B as J,i as K,k as M}from"./index-BAh1-GZ4.js";import{C as D}from"./chunk-RKXMPHPI-DT8Bf2Qm.js";function E(e){return O(e,a=>a==="auto"?"auto":`span ${a}/span ${a}`)}var b=G(function(a,o){const{area:g,colSpan:s,colStart:n,colEnd:w,rowEnd:t,rowSpan:d,rowStart:p,...u}=a,h=R({gridArea:g,gridColumn:E(s),gridRow:E(d),gridColumnStart:n,gridColumnEnd:w,gridRowStart:p,gridRowEnd:t});return r.jsx(F.div,{ref:o,__css:h,...u})});b.displayName="GridItem";function W(){var d,p,u,h,S,y;const e=q.useContext(B),a=V(),{register:o,handleSubmit:g,formState:{errors:s,isSubmitting:n}}=H({defaultValues:{username:(d=e.props.auth)==null?void 0:d.profile.username,email:(p=e.props.auth)==null?void 0:p.profile.email,currency:(u=e.props.auth)==null?void 0:u.profile.default_currency}}),w=async l=>{var I,_,k,z;let i=l;i.email===((I=e.props.auth)==null?void 0:I.profile.email)&&(i.email=void 0),i.username===((_=e.props.auth)==null?void 0:_.profile.username)&&(i.username=void 0),i.currency===((k=e.props.auth)==null?void 0:k.profile.default_currency)&&(i.currency=void 0);const m=await K.post("/dashboard/auth/profile/edit",i,(z=e.props.auth)==null?void 0:z.token);if(m.errors){M(m.errors,a);return}if(m.token){window.localStorage.setItem("auth-token",m.token),window.location.reload();return}await e.updateProfile(),a({status:"success",title:"профиль сохранен!"})},t=P();return r.jsx("form",{onSubmit:g(w),children:r.jsxs(c,{direction:"column",spacing:4,children:[r.jsx(A,{children:"профиль"}),r.jsxs(T,{rowGap:2,columnGap:4,gridTemplateColumns:"auto 1fr",children:[r.jsx(b,{children:r.jsx($,{w:"112px",h:"112px",src:((h=e.props.auth)==null?void 0:h.profile.avatar)+"?d=retro&s=200",borderRadius:"lg"})}),r.jsx(b,{gridColumn:"span 1 / span 1",children:r.jsx(c,{h:"full",direction:"column",spacing:0,justifyContent:"center",alignItems:"start",children:r.jsxs(c,{direction:"row",spacing:2,alignItems:"center",children:[r.jsxs(A,{size:"md",children:["@",(S=e.props.auth)==null?void 0:S.profile.username]}),(y=e.props.auth)!=null&&y.profile.is_verified?r.jsxs(L,{fill:"none",height:"24px",viewBox:"0 0 26 26",width:"24px",xmlns:"http://www.w3.org/2000/svg",children:[r.jsx("path",{d:"m6 6h12v12h-12z",fill:"#fff"}),r.jsx("path",{"clip-rule":"evenodd",d:"m14.38 1.51 1.82 1.82c.37.37.86.57 1.38.57h2.57c1.01 0 1.85.77 1.94 1.76l.01.19v2.57c0 .52.21 1.01.57 1.38l1.82 1.82c.71.71.76 1.84.13 2.61l-.13.15-1.82 1.82c-.37.37-.57.86-.57 1.38v2.57c0 1.01-.77 1.85-1.76 1.94l-.19.01h-2.57c-.52 0-1.01.21-1.38.57l-1.82 1.82c-.71.71-1.84.76-2.61.13l-.15-.13-1.82-1.82c-.37-.37-.86-.57-1.38-.57h-2.57c-1.01 0-1.85-.77-1.94-1.76l-.01-.19v-2.57c0-.52-.21-1.01-.57-1.38l-1.82-1.82c-.71-.71-.76-1.84-.13-2.61l.13-.15 1.82-1.82c.37-.37.57-.86.57-1.38v-2.57c0-1.08.87-1.95 1.95-1.95h2.57c.52 0 1.01-.21 1.38-.57l1.82-1.82c.76-.76 2-.76 2.76 0zm3.2 8.05c-.43-.34-1.03-.31-1.42.06l-.1.11-4.45 5.56-1.75-1.75-.11-.1c-.42-.32-1.03-.29-1.42.1s-.42.99-.1 1.42l.1.11 2.6 2.6.11.1c.42.32 1.02.29 1.4-.08l.1-.11 5.2-6.5.08-.12c.27-.46.17-1.05-.25-1.4z",fill:"var(--aithercol-colors-brand-300)","fill-rule":"evenodd"})]}):r.jsx(r.Fragment,{})]})})}),r.jsx(b,{gridColumn:"span 1 / span 1",textAlign:"center",children:r.jsx(v,{variant:"link",size:"sm",onClick:()=>N("https://gravatar.com/profile"),children:"изменить"})})]}),r.jsxs(c,{direction:"column",spacing:2,children:[r.jsxs(x,{isInvalid:!!s.username,children:[r.jsx(f,{children:"имя пользователя"}),r.jsx(C,{isDisabled:n,placeholder:"введите имя пользователя",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...o("username",{required:!0,validate:l=>/^(?!.*__)[a-zA-Z][a-zA-Z0-9_]{4,31}$/.test(l)||"regex_username"})}),r.jsx(j,{text:"имя пользователя можно менять раз в 30 дней",error:s.username})]}),r.jsxs(x,{isInvalid:!!s.email,children:[r.jsx(f,{children:"email"}),r.jsx(C,{isDisabled:n,placeholder:"введите email",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},type:"email",...o("email",{required:!0})}),r.jsx(j,{error:s.email})]}),r.jsxs(x,{isInvalid:!!s.currency,children:[r.jsx(f,{children:"валюта"}),r.jsx(Z,{isDisabled:n,placeholder:"выберите валюту",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...o("currency",{required:!0}),children:Y().map(l=>r.jsx("option",{value:l,children:l}))}),r.jsx(j,{error:s.currency})]}),r.jsxs(c,{direction:"column",spacing:2,children:[r.jsx(J,{children:r.jsx(D,{in:!t.isOpen,animateOpacity:!0,children:r.jsx(v,{variant:"link",onClick:t.onOpen,children:"изменить пароль"})})}),r.jsx(D,{in:t.isOpen,animateOpacity:!0,children:r.jsxs(x,{isInvalid:!!s.password,children:[r.jsx(f,{children:"новый пароль"}),r.jsx(C,{isDisabled:n,placeholder:"придумайте пароль",type:"password",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...o("password",{required:!1,minLength:3})}),r.jsx(j,{error:s.password})]})})]})]}),r.jsx(v,{type:"submit",children:"сохранить"})]})})}export{W as default};
