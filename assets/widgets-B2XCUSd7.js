import{u as S,r as h,A as k,l as W,j as e,m as z,S as l,n as b,o as f,O as T,q as C,p as F,T as _,t as E,i as I,k as q,W as H,v as L,w as R,H as j,L as A,C as g,f as B,E as G,G as N,J as O,I as v,K as V,a7 as $,h as P,x as M,a8 as J}from"./index-COhIO85z.js";import{C as K}from"./chunk-RKXMPHPI-BFr3T1MF.js";function Q(i){var r,o;const s=S(),c=h.useContext(k),{register:t,handleSubmit:x,formState:{errors:n,isSubmitting:a},reset:m,watch:d}=W({defaultValues:{condition_type:"greater_and_equal"}}),u=async p=>{var y;const w=await I.post("/dashboard/widgets/create",{...p,condition_amount:(p.condition_amount*100).toFixed(0)},(y=c.props.auth)==null?void 0:y.token);if(w.errors){q(w.errors,s);return}await i.refreshData(),m(),i.onClose()};return e.jsx(z,{title:"создать виджет",...i,children:e.jsx("form",{onSubmit:x(u),children:e.jsxs(l,{direction:"column",spacing:2,children:[e.jsxs(b,{isInvalid:!!n.condition_type,children:[e.jsx(f,{children:"условие"}),e.jsxs(T,{isDisabled:a,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...t("condition_type",{required:!0}),children:[e.jsx("option",{value:"greater",children:"больше"}),e.jsx("option",{value:"greater_and_equal",children:"больше или равно"}),e.jsx("option",{value:"equal",children:"равно"})]}),e.jsx(C,{error:n.condition_type})]}),e.jsxs(b,{isInvalid:!!n.condition_type,children:[e.jsxs(f,{children:["сумма в ",(r=c.props.auth)==null?void 0:r.profile.default_currency]}),e.jsx(F,{isDisabled:a,placeholder:"введите сумму",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...t("condition_amount",{required:!0,valueAsNumber:!0,validate:p=>p>0||"bad_number"})}),e.jsx(C,{error:n.condition_type})]}),e.jsxs(_,{fontSize:"sm",children:["виджет сработает только если сумма доната"," ",D[d("condition_type")]," ",d("condition_amount")||0," ",(o=c.props.auth)==null?void 0:o.profile.default_currency]}),e.jsx(E,{type:"submit",isDisabled:a,children:"создать"})]})})})}const D={equal:"равна",greater_and_equal:"больше или равна",greater:"больше"};function Y(){var u;const i=S(),s=h.useContext(k),c=H(),[t,x]=h.useState(),n=async()=>{var o;const r=await I.get("/dashboard/widgets",void 0,(o=s.props.auth)==null?void 0:o.token);if(r.errors){q(r.errors,i);return}x(r.widgets)};h.useEffect(()=>{n()},[]);const[a,m]=L(),d=R();return e.jsxs(l,{direction:"column",spacing:4,children:[e.jsxs(l,{direction:["column","row"],justifyContent:"space-between",alignItems:["start","center"],spacing:2,children:[e.jsx(j,{children:"виджеты"}),(t==null?void 0:t.length)!==0?e.jsx(A,{userSelect:"none",onClick:m.toggle,children:a?"скрыть ссылку для встраивания":"показать ссылку для встраивания"}):e.jsx(e.Fragment,{})]}),t?e.jsxs(e.Fragment,{children:[t.length===0?e.jsx(g,{children:e.jsx(_,{opacity:"0.5",children:"виджеты не найдены (это как вообще? обратитесь в поддержку)"})}):e.jsx(K,{in:a,animateOpacity:!0,children:e.jsxs(b,{children:[e.jsx(f,{children:"ссылка для встраивания"}),e.jsxs(G,{children:[e.jsx(F,{color:"brand.300",value:`https://widget.tipmeadollar.com/?key=${(u=s.props.auth)==null?void 0:u.profile.api_token}`,isReadOnly:!0,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},cursor:"pointer",onFocus:()=>{var r;N(`https://widget.tipmeadollar.com/?key=${(r=s.props.auth)==null?void 0:r.profile.api_token}`)}}),e.jsx(O,{width:"3rem",children:e.jsx(v,{"aria-label":"copy",icon:e.jsx(V,{}),maxW:"1.75rem",minW:"1.75rem",variant:"ghost",h:"1.75rem",size:"sm",onClick:()=>{var r;window.navigator.clipboard.writeText(`https://widget.tipmeadollar.com/?key=${(r=s.props.auth)==null?void 0:r.profile.api_token}`),i({title:"cсылка скопирована"})}})})]}),e.jsx($,{fontWeight:"bold",children:"никому не показывайте ссылку!"})]})}),e.jsxs(P,{columns:[1,2,3],spacing:2,children:[e.jsx(g,{cursor:"pointer",bgColor:"#202020",borderRadius:"lg",p:3,border:"1px solid",borderColor:"transparent",transitionProperty:"var(--aithercol-transition-property-common)",transitionDuration:"var(--aithercol-transition-duration-fast)",transitionTimingFunction:"var(--aithercol-transition-easing-ease-out)",_hover:{borderColor:"brand.500"},onClick:d.onOpen,children:e.jsxs(l,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(M,{}),e.jsx(j,{size:"sm",children:"новый виджет"})]})}),t.map(r=>{var o;return e.jsxs(l,{bgColor:"#202020",borderRadius:"lg",p:3,direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,children:[e.jsxs(l,{direction:"column",spacing:0,children:[e.jsx(j,{size:"sm",children:r.is_default?"стандартный виджет":"дополнительный виджет"}),e.jsxs(_,{fontSize:"sm",children:["если сумма доната ",D[r.condition_type]," ",(r.condition_amount/100).toFixed(2)," ",(o=s.props.auth)==null?void 0:o.profile.default_currency]})]}),e.jsx(v,{"aria-label":"settings",icon:e.jsx(J,{}),size:"sm",onClick:()=>c(`/dashboard/widgets/${r.id}`),variant:"ghost"})]})})]})]}):e.jsx(g,{children:e.jsx(B,{color:"brand.300",size:"xl"})}),e.jsx(Q,{...d,refreshData:n})]})}export{D as condition,Y as default};
