import{r as D,A as I,u as O,l as k,x as q,j as e,S as u,H as A,o as l,p as t,q as p,s as c,O as V,ax as F,B as H,v as C,i as P,k as B}from"./index-8zXq90PO.js";import{C as S}from"./chunk-RKXMPHPI-CFHFxwfB.js";function L(){var h,m,b;const r=D.useContext(I),x=O(),{register:o,handleSubmit:g,formState:{errors:s,isSubmitting:n}}=k({defaultValues:{username:(h=r.props.auth)==null?void 0:h.profile.username,email:(m=r.props.auth)==null?void 0:m.profile.email,currency:(b=r.props.auth)==null?void 0:b.profile.default_currency}}),_=async i=>{var j,v,y,w;let a=i;a.email===((j=r.props.auth)==null?void 0:j.profile.email)&&(a.email=void 0),a.username===((v=r.props.auth)==null?void 0:v.profile.username)&&(a.username=void 0),a.currency===((y=r.props.auth)==null?void 0:y.profile.default_currency)&&(a.currency=void 0);const f=await P.post("/dashboard/auth/profile/edit",a,(w=r.props.auth)==null?void 0:w.token);if(f.errors){B(f.errors,x);return}await r.updateProfile(),x({status:"success",title:"профиль сохранен!"})},d=q();return e.jsx("form",{onSubmit:g(_),children:e.jsxs(u,{direction:"column",spacing:4,children:[e.jsx(A,{children:"профиль"}),e.jsxs(u,{direction:"column",spacing:2,children:[e.jsxs(l,{isInvalid:!!s.username,children:[e.jsx(t,{children:"имя пользователя"}),e.jsx(p,{isDisabled:n,placeholder:"введите имя пользователя",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...o("username",{required:!0,validate:i=>/^(?!.*__)[a-zA-Z][a-zA-Z0-9_]{4,31}$/.test(i)||"regex_username"})}),e.jsx(c,{text:"имя пользователя можно менять раз в 30 дней",error:s.username})]}),e.jsxs(l,{isInvalid:!!s.email,children:[e.jsx(t,{children:"email"}),e.jsx(p,{isDisabled:n,placeholder:"введите email",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},type:"email",...o("email",{required:!0})}),e.jsx(c,{error:s.email})]}),e.jsxs(l,{isInvalid:!!s.currency,children:[e.jsx(t,{children:"валюта"}),e.jsx(V,{isDisabled:n,placeholder:"выберите валюту",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...o("currency",{required:!0}),children:F().map(i=>e.jsx("option",{value:i,children:i}))}),e.jsx(c,{error:s.currency})]}),e.jsxs(u,{direction:"column",spacing:2,children:[e.jsx(H,{children:e.jsx(S,{in:!d.isOpen,animateOpacity:!0,children:e.jsx(C,{variant:"link",onClick:d.onOpen,children:"изменить пароль"})})}),e.jsx(S,{in:d.isOpen,animateOpacity:!0,children:e.jsxs(l,{isInvalid:!!s.password,children:[e.jsx(t,{children:"новый пароль"}),e.jsx(p,{isDisabled:n,placeholder:"придумайте пароль",type:"password",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...o("password",{required:!1,minLength:3})}),e.jsx(c,{error:s.password})]})})]})]}),e.jsx(C,{type:"submit",children:"сохранить"})]})})}export{L as default};
