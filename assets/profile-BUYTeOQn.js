import{r as k,A as I,u as D,l as O,x as q,j as e,S as p,H as A,o as l,p as c,q as x,s as d,O as V,ax as F,B as H,v as S,i as P,k as B}from"./index-Ce_WZ8lJ.js";import{C}from"./chunk-RKXMPHPI-uhoFc3F5.js";function L(){var m,f,b;const r=k.useContext(I),h=D(),{register:i,handleSubmit:g,formState:{errors:s,isSubmitting:n}}=O({defaultValues:{username:(m=r.props.auth)==null?void 0:m.profile.username,email:(f=r.props.auth)==null?void 0:f.profile.email,currency:(b=r.props.auth)==null?void 0:b.profile.default_currency}}),_=async o=>{var j,w,v,y;let a=o;a.email===((j=r.props.auth)==null?void 0:j.profile.email)&&(a.email=void 0),a.username===((w=r.props.auth)==null?void 0:w.profile.username)&&(a.username=void 0),a.currency===((v=r.props.auth)==null?void 0:v.profile.default_currency)&&(a.currency=void 0);const t=await P.post("/dashboard/auth/profile/edit",a,(y=r.props.auth)==null?void 0:y.token);if(t.errors){B(t.errors,h);return}if(t.token){window.localStorage.setItem("auth-token",t.token),window.location.reload();return}await r.updateProfile(),h({status:"success",title:"профиль сохранен!"})},u=q();return e.jsx("form",{onSubmit:g(_),children:e.jsxs(p,{direction:"column",spacing:4,children:[e.jsx(A,{children:"профиль"}),e.jsxs(p,{direction:"column",spacing:2,children:[e.jsxs(l,{isInvalid:!!s.username,children:[e.jsx(c,{children:"имя пользователя"}),e.jsx(x,{isDisabled:n,placeholder:"введите имя пользователя",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...i("username",{required:!0,validate:o=>/^(?!.*__)[a-zA-Z][a-zA-Z0-9_]{4,31}$/.test(o)||"regex_username"})}),e.jsx(d,{text:"имя пользователя можно менять раз в 30 дней",error:s.username})]}),e.jsxs(l,{isInvalid:!!s.email,children:[e.jsx(c,{children:"email"}),e.jsx(x,{isDisabled:n,placeholder:"введите email",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},type:"email",...i("email",{required:!0})}),e.jsx(d,{error:s.email})]}),e.jsxs(l,{isInvalid:!!s.currency,children:[e.jsx(c,{children:"валюта"}),e.jsx(V,{isDisabled:n,placeholder:"выберите валюту",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...i("currency",{required:!0}),children:F().map(o=>e.jsx("option",{value:o,children:o}))}),e.jsx(d,{error:s.currency})]}),e.jsxs(p,{direction:"column",spacing:2,children:[e.jsx(H,{children:e.jsx(C,{in:!u.isOpen,animateOpacity:!0,children:e.jsx(S,{variant:"link",onClick:u.onOpen,children:"изменить пароль"})})}),e.jsx(C,{in:u.isOpen,animateOpacity:!0,children:e.jsxs(l,{isInvalid:!!s.password,children:[e.jsx(c,{children:"новый пароль"}),e.jsx(x,{isDisabled:n,placeholder:"придумайте пароль",type:"password",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...i("password",{required:!1,minLength:3})}),e.jsx(d,{error:s.password})]})})]})]}),e.jsx(S,{type:"submit",children:"сохранить"})]})})}export{L as default};
