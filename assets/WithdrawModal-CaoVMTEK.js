import{u as Q,r as u,A as U,w as X,i as p,k as x,l as Y,j as e,n as Z,S as _,C as ee,f as re,o as C,p as S,O as se,s as F,q as L,av as k,v as P,I as ae,aw as oe,H as te,T as f}from"./index-DWQU1DTz.js";function ie(b){var I,M,D,V,q,A,B,H,N,z;const h=Q(),o=u.useContext(U),[m,j]=X(),[i,R]=u.useState(),[w,T]=u.useState(),[g,v]=u.useState(null);u.useEffect(()=>{(async()=>{var t,n;const r=await p.get("/internal/fiat_rates",{},(t=o.props.auth)==null?void 0:t.token);if(r.errors){x(r.errors,h);return}T(r.rates);const s=await p.get("/dashboard/withdrawals/get_methods",{},(n=o.props.auth)==null?void 0:n.token);if(s.errors){x(s.errors,h);return}R(s.methods)})()},[]);const{register:y,handleSubmit:$,formState:{errors:l,isSubmitting:W,isValid:O},reset:G,watch:c,getValues:J}=Y({mode:"onChange"}),K=async r=>{var t;const s=await p.post("/dashboard/withdrawals/create",{...r,amount:(r.amount*100).toFixed(0)},(t=o.props.auth)==null?void 0:t.token);if(s.errors){x(s.errors,h);return}await b.refresh(),await o.updateProfile(),G(),v(null),b.onClose()},a=()=>i==null?void 0:i.find(r=>r.code===c("method.code"));return e.jsx(Z,{title:"создать выплату",...b,children:e.jsx("form",{onSubmit:$(K),children:e.jsx(_,{direction:"column",spacing:2,children:e.jsx(e.Fragment,{children:i?e.jsx(e.Fragment,{children:g?e.jsxs(e.Fragment,{children:[e.jsxs(_,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(ae,{"aria-label":"back",icon:e.jsx(oe,{}),size:"sm",variant:"ghost",onClick:()=>v(null)}),e.jsx(te,{size:"sm",children:"проверьте информацию"})]}),e.jsxs(_,{direction:"column",spacing:0,children:[e.jsxs(f,{children:["будет отправлено:"," ",g.user_get.method_currency/100," ",(B=a())==null?void 0:B.currency]}),e.jsxs(f,{children:["комиссия: ",g.commission.method_currency/100," ",(H=a())==null?void 0:H.currency]}),e.jsxs(f,{children:["метод: ",(N=a())==null?void 0:N.name]}),e.jsxs(f,{children:[(z=a())==null?void 0:z.valueName,": ",c("method.value")]})]}),e.jsx(P,{type:"submit",isDisabled:W,children:"создать"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{isInvalid:!!((I=l.method)!=null&&I.code),children:[e.jsx(S,{children:"метод"}),e.jsx(se,{isDisabled:m,placeholder:"выберите метод",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...y("method.code",{required:!0}),children:i==null?void 0:i.map(r=>e.jsx("option",{value:r.code,children:r.name}))}),e.jsx(F,{error:(M=l.method)==null?void 0:M.code})]}),c("method.code")&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{isInvalid:!!((D=l.method)!=null&&D.value),children:[e.jsx(S,{children:(V=a())==null?void 0:V.valueName}),e.jsx(L,{isDisabled:m,placeholder:`введите ${(q=a())==null?void 0:q.valueName}`,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...y("method.value",{required:!0})}),e.jsx(F,{error:(A=l.method)==null?void 0:A.value})]}),e.jsxs(C,{isInvalid:!!l.amount,children:[e.jsx(S,{children:"сумма"}),e.jsx(L,{isDisabled:m,placeholder:"введите сумму",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...y("amount",{required:!0,valueAsNumber:!0,validate:r=>{var s,t,n,d,E;return r>0&&r<=(((s=o.props.auth)==null?void 0:s.profile.balance)||0)&&r>=(((t=a())==null?void 0:t.currency)===((n=o.props.auth)==null?void 0:n.profile.default_currency)?((d=a())==null?void 0:d.min_amount)/100:Math.ceil(k(w,a().min_amount,a().currency,((E=o.props.auth)==null?void 0:E.profile.default_currency)||"")/100))||"bad_number"}})}),e.jsx(F,{error:l.amount,errorReplacer:r=>{var s,t,n,d;return c("amount")>=(((s=o.props.auth)==null?void 0:s.profile.balance)||0)?"недостаточно средств на балансе":c("amount")<Math.ceil(k(w,a().min_amount,a().currency,((t=o.props.auth)==null?void 0:t.profile.default_currency)||"")/100)&&c("amount")>0?`минимальная сумма для вывода: ${Math.ceil(k(w,a().min_amount,a().currency,((n=o.props.auth)==null?void 0:n.profile.default_currency)||"")/100)} ${(d=o.props.auth)==null?void 0:d.profile.default_currency}`:r}})]}),e.jsx(P,{onClick:async()=>{var s;j.on();const r=await p.post("/dashboard/withdrawals/create/preview",{...J(),amount:(c("amount")*100).toFixed(0)},(s=o.props.auth)==null?void 0:s.token);if(r.errors){x(r.errors,h),j.off();return}v(r.result),j.off()},isDisabled:!O||m,children:"далее"})]})]})}):e.jsx(ee,{children:e.jsx(re,{size:"xl",color:"brand.300"})})})})})})}export{ie as W};
