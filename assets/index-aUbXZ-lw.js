import{a2 as D,a9 as le,a4 as Q,j as e,a6 as I,aa as P,ab as de,r as u,a1 as G,ac as U,ad as he,a0 as ue,ae as be,af as xe,a3 as me,u as k,A as L,w as B,n as J,C as _,f as M,S as p,T as g,D as je,m as A,v as z,i as T,k as v,Y as fe,H as O,ag as X,q as ge,x as E,I as N,ah as pe,ai as ye,aj as Ce,ak as we,al as _e}from"./index-D_aJkLAs.js";import{T as Z,a as ee,b as se,c as R,d as m,e as te,g as oe,f as j}from"./chunk-MGVPL3OH-DjdhOmD8.js";import{u as Te,T as K}from"./chunk-TK6VMDNP-D3dcuYHm.js";import{W as ve}from"./WithdrawModal-CCHx_ggP.js";var V=D(function(n,o){const a=le("Badge",n),{className:t,...l}=Q(n);return e.jsx(I.span,{ref:o,className:P("chakra-badge",n.className),...l,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});V.displayName="Badge";var[Se,Be,ke,De]=de();function Ie(s){var n;const{defaultIndex:o,onChange:a,index:t,isManual:l,isLazy:h,lazyBehavior:i="unmount",orientation:c="horizontal",direction:d="ltr",...r}=s,[x,b]=u.useState(o??0),[f,S]=Te({defaultValue:o??0,value:t,onChange:a});u.useEffect(()=>{t!=null&&b(t)},[t]);const y=ke(),H=u.useId();return{id:`tabs-${(n=s.id)!=null?n:H}`,selectedIndex:f,focusedIndex:x,setSelectedIndex:S,setFocusedIndex:b,isManual:l,isLazy:h,lazyBehavior:i,orientation:c,descendants:y,direction:d,htmlProps:r}}var[Pe,W]=G({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function Le(s){const{focusedIndex:n,orientation:o,direction:a}=W(),t=Be(),l=u.useCallback(h=>{const i=()=>{var C;const w=t.nextEnabled(n);w&&((C=w.node)==null||C.focus())},c=()=>{var C;const w=t.prevEnabled(n);w&&((C=w.node)==null||C.focus())},d=()=>{var C;const w=t.firstEnabled();w&&((C=w.node)==null||C.focus())},r=()=>{var C;const w=t.lastEnabled();w&&((C=w.node)==null||C.focus())},x=o==="horizontal",b=o==="vertical",f=h.key,S=a==="ltr"?"ArrowLeft":"ArrowRight",y=a==="ltr"?"ArrowRight":"ArrowLeft",F={[S]:()=>x&&c(),[y]:()=>x&&i(),ArrowDown:()=>b&&i(),ArrowUp:()=>b&&c(),Home:d,End:r}[f];F&&(h.preventDefault(),F(h))},[t,n,o,a]);return{...s,role:"tablist","aria-orientation":o,onKeyDown:U(s.onKeyDown,l)}}function ze(s){const{isDisabled:n=!1,isFocusable:o=!1,...a}=s,{setSelectedIndex:t,isManual:l,id:h,setFocusedIndex:i,selectedIndex:c}=W(),{index:d,register:r}=De({disabled:n&&!o}),x=d===c,b=()=>{t(d)},f=()=>{i(d),!l&&!(n&&o)&&t(d)};return{...he({...a,ref:ue(r,s.ref),isDisabled:n,isFocusable:o,onClick:U(s.onClick,b)}),id:ne(h,d),role:"tab",tabIndex:x?0:-1,type:"button","aria-selected":x,"aria-controls":ae(h,d),onFocus:n?void 0:U(s.onFocus,f)}}var[Me,Fe]=G({});function Ne(s){const n=W(),{id:o,selectedIndex:a}=n,l=be(s.children).map((h,i)=>u.createElement(Me,{key:i,value:{isSelected:i===a,id:ae(o,i),tabId:ne(o,i),selectedIndex:a}},h));return{...s,children:l}}function Ae(s){const{children:n,...o}=s,{isLazy:a,lazyBehavior:t}=W(),{isSelected:l,id:h,tabId:i}=Fe(),c=u.useRef(!1);l&&(c.current=!0);const d=xe({wasSelected:c.current,isSelected:l,enabled:a,mode:t});return{tabIndex:0,...o,children:d?n:null,role:"tabpanel","aria-labelledby":i,hidden:!l,id:h}}function ne(s,n){return`${s}--tab-${n}`}function ae(s,n){return`${s}--tabpanel-${n}`}var[Ee,$]=G({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),re=D(function(n,o){const a=me("Tabs",n),{children:t,className:l,...h}=Q(n),{htmlProps:i,descendants:c,...d}=Ie(h),r=u.useMemo(()=>d,[d]),{isFitted:x,...b}=i,f={position:"relative",...a.root};return e.jsx(Se,{value:c,children:e.jsx(Pe,{value:r,children:e.jsx(Ee,{value:a,children:e.jsx(I.div,{className:P("chakra-tabs",l),ref:o,...b,__css:f,children:t})})})})});re.displayName="Tabs";var ie=D(function(n,o){const a=Le({...n,ref:o}),l={display:"flex",...$().tablist};return e.jsx(I.div,{...a,className:P("chakra-tabs__tablist",n.className),__css:l})});ie.displayName="TabList";var q=D(function(n,o){const a=Ae({...n,ref:o}),t=$();return e.jsx(I.div,{outline:"0",...a,className:P("chakra-tabs__tab-panel",n.className),__css:t.tabpanel})});q.displayName="TabPanel";var ce=D(function(n,o){const a=Ne(n),t=$();return e.jsx(I.div,{...a,width:"100%",ref:o,className:P("chakra-tabs__tab-panels",n.className),__css:t.tabpanels})});ce.displayName="TabPanels";var Y=D(function(n,o){const a=$(),t=ze({...n,ref:o}),l={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return e.jsx(I.button,{...t,className:P("chakra-tabs__tab",n.className),__css:l})});Y.displayName="Tab";function Oe(s){const n=k(),o=u.useContext(L),[a,t]=u.useState(),[l,h]=B(),[i,c]=u.useState(),d=async r=>{var b;h.on();const x=await T.get("/dashboard/admin/donations",{page:r||1,limit:25,user:s.user.id},(b=o.props.auth)==null?void 0:b.token);if(x.errors){v(x.errors,n);return}t(r?[...a||[],...x.donations.data]:x.donations.data),c(x.donations.meta),h.off()};return u.useEffect(()=>{s.isOpen&&d()},[s.isOpen]),e.jsx(J,{size:"lg",title:"донаты",...s,children:a?e.jsxs(p,{direction:"column",spacing:2,children:[a.map(r=>e.jsxs(p,{direction:"column",spacing:1,bgColor:"#252525",p:3,borderRadius:"lg",children:[e.jsxs(g,{children:[e.jsx("b",{children:r.name||"аноним"})," отправил"," ",e.jsxs("b",{children:[r.amount/100," ",r.currency]})]}),r.message?e.jsx(g,{fontSize:"sm",children:r.message}):null,r.audio?e.jsx(je,{controls:!0,src:r.audio}):null,e.jsxs(p,{direction:"column",spacing:0,children:[e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Email:"})," ",r.email]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Метод:"})," ",r.payment_method]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Оплачен:"})," ",A(r.paid_at).format("LLL")]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Создан:"})," ",A(r.created_at).format("LLL")]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Пользователь оплатил:"})," ",r.user_amount/100," ",r.currency]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Стример получил:"})," ",(r.amount-r.commission_amount)/100," ",r.currency]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Админы получили:"})," ",r.admin_amount/100," ",r.currency]})]})]})),(i==null?void 0:i.current_page)!==(i==null?void 0:i.last_page)&&e.jsx(_,{children:e.jsx(z,{isDisabled:l,onClick:()=>d((i==null?void 0:i.current_page)+1),children:"показать еще"})})]}):e.jsx(_,{children:e.jsx(M,{size:"xl",color:"brand.300"})})})}function Re(s){const n=k(),[o,a]=u.useState();return u.useEffect(()=>{s.isOpen&&!o&&(async()=>{const t=await T.get("/internal/payment_methods");if(t.errors){v(t.errors,n);return}a(t.methods)})()},[s.isOpen]),e.jsx(J,{title:"методы",...s,children:o?e.jsx(p,{direction:"column",spacing:2,children:o.map(t=>e.jsx(We,{...s,method:t}))}):e.jsx(_,{children:e.jsx(M,{size:"xl",color:"brand.300"})})})}const We=({method:s,...n})=>{const o=k(),a=u.useContext(L),[t,l]=B(),[h,i]=B(!n.user.disabled_methods.includes(s.code));return e.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(p,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(fe,{src:s.image,w:"40px",h:"40px",borderRadius:"999px"}),e.jsx(O,{size:"sm",children:s.name})]}),e.jsx(X,{colorScheme:"brand",isChecked:h,isDisabled:t,onChange:async()=>{var d;l.on();const c=await T.post("/dashboard/admin/users/update",{action:"toggleMethod",id:n.user.id,method:s.code},(d=a.props.auth)==null?void 0:d.token);if(c.errors){v(c.errors,o),l.off();return}i.toggle(),l.off()}})]})};function $e(){const s=k(),n=u.useContext(L),[o,a]=u.useState(),[t,l]=u.useState(),[h,i]=u.useState(""),[c,d]=u.useState({balance:!1,search:""}),[r,x]=B(),b=async f=>{var S;x.on();try{const y=await T.get("/dashboard/admin/users",{page:f||1,limit:25,...c},(S=n.props.auth)==null?void 0:S.token);if(y.errors){v(y.errors,s);return}a(f?[...o||[],...y.users.data]:y.users.data),l(y.users.meta)}catch(y){console.error(y)}finally{x.off()}};return u.useEffect(()=>{b()},[c]),u.useEffect(()=>{if(t){const f=setTimeout(()=>{d({...c,search:h})},500);return()=>clearTimeout(f)}},[h]),e.jsx(e.Fragment,{children:o?e.jsxs(p,{direction:"column",spacing:2,children:[e.jsxs(p,{direction:["column","row"],justifyContent:"space-between",spacing:2,alignItems:["start","center"],children:[e.jsx(ge,{placeholder:"поиск по ID, логину, email",isDisabled:r,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},value:h,onChange:f=>i(f.currentTarget.value),maxW:["full","250px"]}),e.jsxs(p,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(X,{isChecked:c.balance,onChange:()=>d({...c,balance:!c.balance}),colorScheme:"brand",size:"lg",isDisabled:r}),e.jsx(g,{children:"только с балансом"})]})]}),o.length===0&&e.jsx(_,{children:e.jsx(g,{opacity:"0.5",children:"пользователи не найдены"})}),o.length!==0&&e.jsx(Z,{children:e.jsxs(ee,{variant:"simple",children:[e.jsx(se,{children:e.jsxs(R,{children:[e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"ID"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"email"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"логин"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"баланс"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"комиссия"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"дата регистрации"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"флаги"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5"})]})}),e.jsx(te,{children:o.map(f=>e.jsx(He,{user:f,refresh:()=>b()}))}),(t==null?void 0:t.current_page)!==(t==null?void 0:t.last_page)&&e.jsx(oe,{mt:0,children:e.jsx(_,{children:e.jsx(z,{isDisabled:r,onClick:()=>b((t==null?void 0:t.current_page)+1),children:"показать еще"})})})]})})]}):e.jsx(_,{children:e.jsx(M,{color:"brand.300",size:"xl"})})})}function He({user:s,refresh:n}){const[o,a]=B(),t=u.useContext(L),l=k(),h=E(),i=E();return e.jsxs(R,{children:[e.jsxs(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:["#",s.id]}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.email}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.username}),e.jsxs(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.balance/100," ",s.default_currency]}),e.jsxs(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.commission_percent,"%"]}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:A(s.created_at).format("LLL")}),e.jsxs(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.is_admin?e.jsx(V,{colorScheme:"green",children:"администратор"}):e.jsx(e.Fragment,{})," ",s.is_banned?e.jsx(V,{colorScheme:"brand",children:"забанен"}):e.jsx(e.Fragment,{})]}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:e.jsxs(p,{direction:"row",spacing:2,children:[e.jsx(K,{label:s.is_banned?"разбанить":"забанить",children:e.jsx(N,{"aria-label":"ban",icon:s.is_banned?e.jsx(pe,{}):e.jsx(ye,{}),isDisabled:o,onClick:async()=>{var d;a.on();const c=await T.post("/dashboard/admin/users/update",{action:s.is_banned?"unban":"ban",id:s.id},(d=t.props.auth)==null?void 0:d.token);if(c.errors){v(c.errors,l),a.off();return}l({status:"success",title:`пользователь ${s.is_banned?"разбанен":"забанен"}!`}),await n(),a.off()}})}),e.jsx(K,{label:"донаты",children:e.jsx(N,{onClick:i.onOpen,"aria-label":"donates",icon:e.jsx(Ce,{}),isDisabled:o})}),e.jsx(K,{label:"методы",children:e.jsx(N,{onClick:h.onOpen,"aria-label":"methods",icon:e.jsx(we,{}),isDisabled:o})})]})}),e.jsx(Re,{...h,user:s}),e.jsx(Oe,{...i,user:s})]})}function Ke(s){const n=k(),o=u.useContext(L),[a,t]=B(),[l,h]=u.useState();u.useEffect(()=>{s.isOpen&&(async()=>{var d;const c=await T.post("/dashboard/withdrawals/create/preview",{user:s.user,method:s.withdraw.payment_method,amount:s.withdraw.amount},(d=o.props.auth)==null?void 0:d.token);if(c.errors){v(c.errors,n),t.off();return}h(c.result)})()},[s.isOpen]);const i=async c=>{var r;const d=await T.post("/dashboard/admin/withdrawals/handle",{id:s.withdraw.id,status:c},(r=o.props.auth)==null?void 0:r.token);if(d.errors){v(d.errors,n),t.off();return}s.refresh(),s.onClose(),t.off()};return e.jsx(J,{title:"обработка выплаты",...s,children:e.jsx(p,{direction:"column",spacing:2,children:l?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:"sm",children:"отправьте выплату"}),e.jsxs(p,{direction:"column",spacing:0,children:[e.jsxs(g,{children:["сумма: ",l.user_get.method_currency/100," ",s.withdraw.payment_method.currency]}),e.jsxs(g,{children:["метод: ",s.withdraw.payment_method.name]}),e.jsxs(g,{children:[s.withdraw.payment_method.valueName,":"," ",s.withdraw.payment_method.value]})]}),e.jsx(z,{isDisabled:a,onClick:()=>i("ok"),children:"отправлено"}),e.jsx(z,{isDisabled:a,onClick:()=>i("error"),variant:"ghost",children:"произошла ошибка"})]}):e.jsx(_,{children:e.jsx(M,{size:"xl",color:"brand.300"})})})})}function Ue(){const s=u.useContext(L),n=k(),[o,a]=u.useState(),[t,l]=u.useState(),[h,i]=B(),c=async r=>{var x;i.on();try{const b=await T.get("/dashboard/admin/withdrawals",{page:r||1,limit:25},(x=s.props.auth)==null?void 0:x.token);if(b.errors){v(b.errors,n);return}a(r?[...o||[],...b.withdrawals.data]:b.withdrawals.data),l(b.withdrawals.meta)}catch(b){console.error(b)}finally{i.off()}};u.useEffect(()=>{c()},[]);const d=E();return e.jsxs(p,{direction:"column",spacing:4,children:[e.jsx(O,{children:"выплаты"}),o?e.jsx(e.Fragment,{children:o.length===0?e.jsx(_,{children:e.jsx(g,{opacity:"0.5",children:"выплаты не найдены"})}):e.jsx(Z,{children:e.jsxs(ee,{variant:"simple",children:[e.jsx(se,{children:e.jsxs(R,{children:[e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"#"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"ID пользователя"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"получатель"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"сумма"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"метод"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"дата и время"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"статус"}),e.jsx(m,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5"})]})}),e.jsx(te,{children:o.map(r=>e.jsx(Ve,{withdraw:r,refresh:c}))}),(t==null?void 0:t.current_page)!==(t==null?void 0:t.last_page)&&e.jsx(oe,{mt:0,children:e.jsx(_,{children:e.jsx(z,{isDisabled:h,onClick:()=>c((t==null?void 0:t.current_page)+1),children:"показать еще"})})})]})})}):e.jsx(_,{children:e.jsx(M,{color:"brand.300",size:"xl"})}),e.jsx(ve,{refresh:c,...d})]})}function Ve({withdraw:s,refresh:n}){const o={ok:{text:"успешно",color:"green.500"},waiting:{text:"в обработке",color:"yellow.500"},error:{text:"ошибка",color:"red.500"}},a=E();return e.jsxs(R,{children:[e.jsxs(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:["#",s.id]}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.user_id}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.payment_method.value}),e.jsxs(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.amount/100," ",s.currency]}),e.jsx(j,{opacity:"0.5",borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.commission_amount!==0?`-${(s.commission_amount/100).toFixed(2)} ${s.currency}`:""}),e.jsx(j,{maxW:"300px",css:{textWrap:"balance"},borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.payment_method.name}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:A(s.created_at).format("LLL")}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:o[s.status].color,children:o[s.status].text}),e.jsx(j,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.status==="waiting"?e.jsx(N,{"aria-label":"handle",onClick:a.onOpen,icon:e.jsx(_e,{})}):e.jsx(e.Fragment,{})}),e.jsx(Ke,{...a,refresh:n,user:s.user_id,withdraw:s})]})}function Qe(){return e.jsxs(p,{direction:"column",spacing:4,children:[e.jsx(O,{children:"админка"}),e.jsxs(re,{isLazy:!0,colorScheme:"brand",children:[e.jsxs(ie,{children:[e.jsx(Y,{children:"пользователи"}),e.jsx(Y,{children:"выплаты"})]}),e.jsxs(ce,{children:[e.jsx(q,{children:e.jsx($e,{})}),e.jsx(q,{children:e.jsx(Ue,{})})]})]})]})}export{Qe as default};
