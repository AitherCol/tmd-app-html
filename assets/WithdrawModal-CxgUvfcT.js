import{u as Z,r as u,A as ee,w as re,i as p,k as x,l as se,j as e,n as oe,S as y,C as ae,f as te,o as C,p as S,O as ne,s as F,q as T,av as k,v as W,I as ie,aw as ce,H as le,T as f}from"./index-DxwZaG23.js";function ue(b){var I,M,$,D,V,q,A,B,H,N,z,E,L,P;const h=Z(),a=u.useContext(ee),[m,j]=re(),[c,O]=u.useState(),[v,G]=u.useState(),[w,g]=u.useState(null);u.useEffect(()=>{(async()=>{var t,i;const r=await p.get("/internal/fiat_rates",{},(t=a.props.auth)==null?void 0:t.token);if(r.errors){x(r.errors,h);return}G(r.rates);const o=await p.get("/dashboard/withdrawals/get_methods",{},(i=a.props.auth)==null?void 0:i.token);if(o.errors){x(o.errors,h);return}O(o.methods)})()},[]);const{register:_,handleSubmit:J,formState:{errors:l,isSubmitting:K,isValid:Q},reset:U,watch:n,getValues:X}=se({mode:"onChange"}),Y=async r=>{var t;const o=await p.post("/dashboard/withdrawals/create",{...r,amount:(r.amount*100).toFixed(0)},(t=a.props.auth)==null?void 0:t.token);if(o.errors){x(o.errors,h);return}await b.refresh(),await a.updateProfile(),U(),g(null),b.onClose()},s=()=>c==null?void 0:c.find(r=>r.code===n("method.code"));return e.jsx(oe,{title:"создать выплату",...b,children:e.jsx("form",{onSubmit:J(Y),children:e.jsx(y,{direction:"column",spacing:2,children:e.jsx(e.Fragment,{children:c?e.jsx(e.Fragment,{children:w?e.jsxs(e.Fragment,{children:[e.jsxs(y,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(ie,{"aria-label":"back",icon:e.jsx(ce,{}),size:"sm",variant:"ghost",onClick:()=>g(null)}),e.jsx(le,{size:"sm",children:"проверьте информацию"})]}),e.jsxs(y,{direction:"column",spacing:0,children:[e.jsxs(f,{children:["будет отправлено:"," ",w.user_get.method_currency/100," ",(z=s())==null?void 0:z.currency]}),e.jsxs(f,{children:["комиссия: ",w.commission.method_currency/100," ",(E=s())==null?void 0:E.currency]}),e.jsxs(f,{children:["метод: ",(L=s())==null?void 0:L.name]}),e.jsxs(f,{children:[(P=s())==null?void 0:P.valueName,": ",n("method.value")]})]}),e.jsx(W,{type:"submit",isDisabled:K,children:"создать"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{isInvalid:!!((I=l.method)!=null&&I.code),children:[e.jsx(S,{children:"метод"}),e.jsx(ne,{isDisabled:m,placeholder:"выберите метод",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},..._("method.code",{required:!0}),children:c==null?void 0:c.map(r=>e.jsx("option",{value:r.code,children:r.name}))}),e.jsx(F,{error:(M=l.method)==null?void 0:M.code,text:n("method.code")?`Комиссия: ${($=s())==null?void 0:$.commission_percent}%`+(((D=s())==null?void 0:D.commission_amount)!==0?` + ${((V=s())==null?void 0:V.commission_amount)/100} ${(q=s())==null?void 0:q.currency}`:""):void 0})]}),n("method.code")&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{isInvalid:!!((A=l.method)!=null&&A.value),children:[e.jsx(S,{children:(B=s())==null?void 0:B.valueName}),e.jsx(T,{isDisabled:m,placeholder:`введите ${(H=s())==null?void 0:H.valueName}`,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},..._("method.value",{required:!0})}),e.jsx(F,{error:(N=l.method)==null?void 0:N.value})]}),e.jsxs(C,{isInvalid:!!l.amount,children:[e.jsx(S,{children:"сумма"}),e.jsx(T,{isDisabled:m,placeholder:"введите сумму",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},..._("amount",{required:!0,valueAsNumber:!0,validate:r=>{var o,t,i,d,R;return r>0&&r<=(((o=a.props.auth)==null?void 0:o.profile.balance)||0)&&r>=(((t=s())==null?void 0:t.currency)===((i=a.props.auth)==null?void 0:i.profile.default_currency)?((d=s())==null?void 0:d.min_amount)/100:Math.ceil(k(v,s().min_amount,s().currency,((R=a.props.auth)==null?void 0:R.profile.default_currency)||"")/100))||"bad_number"}})}),e.jsx(F,{error:l.amount,errorReplacer:r=>{var o,t,i,d;return n("amount")>=(((o=a.props.auth)==null?void 0:o.profile.balance)||0)?"недостаточно средств на балансе":n("amount")<Math.ceil(k(v,s().min_amount,s().currency,((t=a.props.auth)==null?void 0:t.profile.default_currency)||"")/100)&&n("amount")>0?`минимальная сумма для вывода: ${Math.ceil(k(v,s().min_amount,s().currency,((i=a.props.auth)==null?void 0:i.profile.default_currency)||"")/100)} ${(d=a.props.auth)==null?void 0:d.profile.default_currency}`:r}})]}),e.jsx(W,{onClick:async()=>{var o;j.on();const r=await p.post("/dashboard/withdrawals/create/preview",{...X(),amount:(n("amount")*100).toFixed(0)},(o=a.props.auth)==null?void 0:o.token);if(r.errors){x(r.errors,h),j.off();return}g(r.result),j.off()},isDisabled:!Q||m,children:"далее"})]})]})}):e.jsx(ae,{children:e.jsx(te,{size:"xl",color:"brand.300"})})})})})})}export{ue as W};
